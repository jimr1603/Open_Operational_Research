?get_stats
?get_stats19
crashes <- get_stats19(year = 2017, type = "Accidents", ask = FALSE)
casualties <- get_stats19(year = 2017, type = "Casualties", ask = FALSE)
vehicles <- get_stats19(year = 2017, type = "Vehicles", ask = FALSE)
View(casualties)
casualties %>%
group_by(casualty_class) %>%
summarise(n=n())
casualties %>%
group_by(casualty_severity) %>%
summarise(n=n())
casualties %>%
group_by(casualty_severity) %>%
summarise(n=n()) %>%
knitr::kable()
blogdown::serve_site()
?blogdown::serve_site()
blogdown::stop_server()
casualties %>%
filter(age_of_casualty >= 0)
knitr::opts_chunk$set(
message = FALSE,
warning = FALSE,
collapse = TRUE
)
library("tidyverse")
library("stats19")
theme_and_scale <- ggthemes::theme_few() + ggthemes::scale_fill_few()
casualties %>%
filter(age_of_casualty >= 0) %>%
ggplot(aes(x=age_of_casualty)) + geom_density() + facet_wrap(~casualty_severity)
ggplot(aes(x=age_of_casualty)) + geom_density() + facet_wrap(~casualty_severity)
casualties %>%
filter(age_of_casualty >= 0) %>%
ggplot(aes(x=age_of_casualty)) + geom_density() + facet_wrap(~casualty_severity)
casualties %>%
filter(age_of_casualty >= 0) %>%
filter(sex_of_casualty %in% c("Male", "Female")) %>%
ggplot(aes(x=age_of_casualty)) + geom_density() + facet_grid(sex_of_casualty~casualty_severity)
casualties %>%
filter(age_of_casualty >= 0) %>%
filter(sex_of_casualty %in% c("Male", "Female")) %>%
ggplot(aes(x=age_of_casualty)) + geom_density() + facet_grid(sex_of_casualty~casualty_severity) + ggthemes::theme_few() + ggthemes::scale_colour_few()
casualties %>%
filter(age_of_casualty >= 0) %>%
filter(sex_of_casualty %in% c("Male", "Female")) %>%
ggplot(aes(x=age_of_casualty, colour=sex_of_casualty)) + geom_density() + facet_grid(~casualty_severity) + ggthemes::theme_few() + ggthemes::scale_colour_few()
casualties %>%
filter(age_of_casualty >= 0) %>%
filter(sex_of_casualty %in% c("Male", "Female")) %>%
ggplot(aes(x=age_of_casualty, colour=sex_of_casualty)) + geom_density() + facet_grid(~casualty_severity) + ggthemes::theme_few() + ggthemes::scale_colour_few()
casualties %>%
filter(age_of_casualty >= 0) %>%
filter(sex_of_casualty %in% c("Male", "Female")) %>%
ggplot(aes(x=age_of_casualty, colour=sex_of_casualty)) + geom_density() + facet_grid(~casualty_severity) + ggthemes::theme_few() + ggthemes::scale_colour_few()
View(vehicles)
vehicles %>% filter(vehicle_type == "Motorcycle 50cc and under")
vehicles %>% filter(vehicle_type == "Motorcycle 50cc and under") %>% View()
vehicles %>% pull(vehicle_type) %>% unique()
vehicles %>%
filter(vehicle_type == "Mobility scooter")
vehicles %>%
filter(vehicle_type == "Mobility scooter") %>% View()
crashes %>% filter(accident_index == 2017030162341)
crashes %>% filter(accident_index == 2017030162341) %>% View()
ids <- vehicles %>%
filter(vehicle_type == "Mobility Scooter") %>%
pull(accident_index)
vehicles %>%
filter(vehicle_type == "Mobility Scooter")
vehicles %>%
filter(vehicle_type == "Mobility Scooter")
vehicles %>%
filter(vehicle_type == "Mobility scooter") %>% View()
ids <- vehicles %>%
filter(vehicle_type == "Mobility scooter") %>%
pull(accident_index)
ids
vehicles %>%
filter(str_detect(vehicle_type, "50cc" ))
vehicles %>%
filter(str_detect(vehicle_type, "50cc" )) %>%
filter(age_of_driver>0) %>%
ggplot(aes(x=age_of_driver)) + geom_density()
crashes %>%
filter(accident_index %in% ids) %>%
View()
casualties %>%
filter(accident_index %in% ids)
casualties %>%
filter(accident_index %in% ids) %>% View()
casualties %>%
filter(accident_index %in% ids) %>% View()
casualties %>%
filter(accident_index %in% ids) %>%
group_by(casualty_class) %>%
summarise(n=n())
View(crashes)
View(vehicles)
View(vehicles)
vehicles %>% group_by(vehicle_type) %>% summarise(n=n())
vehicles %>%
filter(vehicle_type == "Agricultural vehicle")
ids <- vehicles %>%
filter(vehicle_type == "Agricultural vehicle")  %>%
pull(accident_index)
crashes %>%
filter(id %in% ids)
crashes %>%
filter(accident_index %in% ids)
crashes %>%
filter(accident_index %in% ids) %>% View()
library("sf")
agri_crashes <- crashes %>%
filter(accident_index %in% ids) %>%
format_sf()
plot(agri_crashes)
plot(agri_crashes$accident_severity)
plot(agri_crashes[accident_severity,])
plot(agri_crashes["accident_severity"])
agri_crashes %>%
aggregate(by=police_boundaries, FUN=length)
agri_crashes %>%
select(id=accident_index ) %>%
aggregate(by=police_boundaries, FUN=length)
agri_crashes %>%
select(id=accident_index ) %>%
aggregate(by=police_boundaries, FUN=length) %>%
plot()
police_boundaries
local_authority
la
?police_boundaries
sf:::plot.sf(police_boundaries)
blogdown::serve_site()
blogdown::stop_server()
?blogdown::serve_site()
?servr::httw
blogdown::serve_site(port = 9999)
blogdown::stop_server()
blogdown::serve_site(host = '0.0.0.0')
View(vehicles)
vehicles %>%
filter(vehicle_type == "Mobility Scooter")
vehicles %>%
filter(vehicle_type == "Mobility scooter")
vehicles %>%
filter(vehicle_type == "Mobility scooter")
knitr::opts_chunk$set(
message = FALSE,
warning = FALSE,
collapse = TRUE
)
library("tidyverse")
library("stats19")
library("sf")
scooter_ids <- vehicles %>%
filter(vehicle_type == "Mobility scooter") %>%
pull(accident_index)
vehicles %>%
filter(accident_index %in% scooter_ids) %>% View()
scooter_ids <- vehicles %>%
filter(vehicle_type == "Mobility scooter") %>%
pull(accident_index)
scooter_and_another_vehicle <- vehicles %>%
filter(accident_index %in% scooter_ids) %>%
filter(vehicle_type != "Mobility scooter") %>%
pull(accident_index)
ids <- setdiff(scooter_ids, scooter_and_another_vehicle)
crashes %>%
filter(accident_index %in% ids)
crashes %>%
filter(accident_index %in% ids) %>% View()
scooter_ids <- vehicles %>%
filter(vehicle_type == "Mobility scooter") %>%
pull(accident_index)
scooter_and_another_vehicle <- vehicles %>%
filter(accident_index %in% scooter_ids) %>%
filter(vehicle_type != "Mobility scooter") %>%
pull(accident_index)
ids <- setdiff(scooter_ids, scooter_and_another_vehicle)
scooter_only <- crashes %>%
filter(accident_index %in% ids)
nrow(scooter_only)
casualties %>%
filter(accident_index %in% ids)
casualties %>%
filter(accident_index %in% ids) %>%
group_by(casualty_severity) %>%
summarise(n=n())
casualties %>%
filter(accident_index %in% ids) %>% View()
casualties %>%
filter(accident_index %in% ids) %>%
group_by(casualty_class) %>%
summarise(n=n())
crashes %>%
filter(id %in% ids) %>%
format_sf() %>%
select(id = accident_index) %>%
aggregate(by=police_boundaries, FUN=length) %>%
plot()
crashes %>%
filter(id %in% ids) %>%
format_sf()
crashes %>%
filter(accident_index %in% ids) %>%
format_sf() %>%
select(id = accident_index) %>%
aggregate(by=police_boundaries, FUN=length) %>%
plot()
View(vehicles)
View(crashes)
View(casualties)
casualties %>%
filter(casualty_type == "Cyclist") %>%
group_by(casualty_severity) %>%
summarise(n=n())
casualties %>%
filter(casualty_type != "Cyclist") %>%
group_by(casualty_severity) %>%
summarise(n=n())
casualties %>%
filter(casualty_type != "Cyclist") %>%
group_by(casualty_severity) %>%
summarise(n=n()) %>%
summarise(n=n/sum(n))
casualties %>%
filter(casualty_type != "Cyclist") %>%
group_by(casualty_severity) %>%
summarise(n=n()) %>%
mutate(n=n/sum(n))
casualties %>%
filter(casualty_type == "Cyclist") %>%
group_by(casualty_severity) %>%
summarise(n=n()) %>%
mutate(n=n/sum(n))
casualties %>%
filter(casualty_type == "Cyclist") %>%
group_by(casualty_severity) %>%
summarise(n=n()) %>%
mutate(proportion=n/sum(n)) %>%
knitr::kable()
police_boundaries
police_boundaries$pfa16nm
wy_boundary <-  police_boundaries[police_boundaries$pfa16nm == "West Yorkshire", ]
wy_boundary
plot(wy_boundary$pfa16cd)
plot(wy_boundary)
?st_within
casualties %>%
format_sf() %>%
st_within(wy_boundary) %>%
filter(casualty_type == "Cyclist") %>%
group_by(casualty_severity) %>%
summarise(n=n()) %>%
mutate(proportion=n/sum(n)) %>%
knitr::kable()
wy_boundary <-  police_boundaries[police_boundaries$pfa16nm == "West Yorkshire", ]
casualties %>%
format_sf() %>%
st_within(wy_boundary) %>%
filter(casualty_type == "Cyclist") %>%
group_by(casualty_severity) %>%
summarise(n=n()) %>%
mutate(proportion=n/sum(n)) %>%
knitr::kable()
class(wy_boundary)
casualties %>%
format_sf() %>% class()
casualties
casualties %>%
filter(casualty_type == "Cyclist") %>%
format_sf()
wy_crashes <- crashes %>%
format_sf() %>%
st_within(wy_boundary)
plot(wy_crashes)
wy_crashes
wy_crashes <- crashes %>%
format_sf()
wy_crashes <- wy_crashes[wy_boundary, ]
wy_crashes
plot(wy_crashes)
wy_boundary <-  police_boundaries[police_boundaries$pfa16nm == "West Yorkshire", ]
wy_crashes <- crashes %>%
format_sf()
wy_crashes <- wy_crashes[wy_boundary, ]
casualties %>%
filter(accident_index %in% wy_crashes$accident_index) %>%
filter(casualty_type == "Cyclist") %>%
group_by(casualty_severity) %>%
summarise(n=n()) %>%
mutate(proportion=n/sum(n)) %>%
knitr::kable()
casualties %>%
filter(accident_index %in% wy_crashes$accident_index) %>%
filter(casualty_type != "Cyclist") %>%
group_by(casualty_severity) %>%
summarise(n=n()) %>%
mutate(proportion=n/sum(n)) %>%
knitr::kable()
121/37
121/37
cyclists <- casualties %>%
filter(casualty_type == "Cyclist") %>%
pull(accident_index)
cyclists
wy_crashes %>%
filter(accident_index %in% cyclists) %>%
plot()
cyc <- wy_crashes %>%
filter(accident_index %in% cyclists)
plot(cyc$accident_index)
plot(cyc[accident_index,])
plot(cyc["accident_index",])
plot(cyc)
plot(cyc, max.plot = 1)
library(leaflet)
install.packages("leaflet")
leaflet::leaflet(cyc)
male_driving <- vehicles %>%
filter(sex_of_driver == "Male", vehicle_type == "Car")
female_driving <- vehicles %>%
filter(sex_of_driver == "Female", vehicle_type == "Car")
View(female_driving)
vehicles %>%
mutate(male = if_else(accident_index %in% male_driving, 1, 0))
unknown_other <- vehicles %>%
filter(accident_index %in% male_driving) %>%
filter(vehicle_type == "Car", sex_of_driver == "Not known") %>%
pull(accident_index)
blogdown::serve_site(host = '0.0.0.0')
male_crash <- crashes %>%
filter(accident_index %in% male_driving) %>%
select(accident_severity, number_of_casualties)
male_driving
male_driving <- vehicles %>%
filter(sex_of_driver == "Male", vehicle_type == "Car") %>%
pull(accident_index)
unknown_other <- vehicles %>% #Filter out accident IDs where there's someone of unknown sex driving a car.
filter(accident_index %in% male_driving) %>%
filter(vehicle_type == "Car", sex_of_driver == "Not known") %>%
pull(accident_index)
male_driving <- setdiff(male_driving, unknown_other)
female_driving <- vehicles %>%
filter(sex_of_driver == "Female", vehicle_type == "Car") %>%
pull(accident_index)
unknown_other <- vehicles %>% #Filter out accident IDs where there's someone of unknown sex driving a car.
filter(accident_index %in% female_driving) %>%
filter(vehicle_type == "Car", sex_of_driver == "Not known") %>%
pull(accident_index)
female_driving <- setdiff(female_driving, unknown_other)
male_crash <- crashes %>%
filter(accident_index %in% male_driving) %>%
select(accident_severity, number_of_casualties)
male_crash
gendered_crashes <- bind_rows(male_crash, female_crash)
gendered_crashes %>%
group_by(driver, accident_severity) %>%
summarise(n=n())
male_crash <- crashes %>%
filter(accident_index %in% male_driving) %>%
select(accident_severity, number_of_casualties) %>%
mutate(driver = "Male")
female_crash <- crashes %>%
filter(accident_index %in% female_driving) %>%
select(accident_severity, number_of_casualties) %>%
mutate(driver = "Female")
##In crashes where there was a male driver and a female driver, we've double counted.
gendered_crashes <- bind_rows(male_crash, female_crash)
gendered_crashes %>%
group_by(driver, accident_severity) %>%
summarise(n=n())
male_driving <- vehicles %>%
filter(sex_of_driver == "Male", vehicle_type == "Car") %>%
pull(accident_index)
unknown_other <- vehicles %>% #Filter out accident IDs where there's someone of unknown sex driving a car.
filter(accident_index %in% male_driving) %>%
filter(vehicle_type == "Car", sex_of_driver == "Not known") %>%
pull(accident_index)
male_driving <- setdiff(male_driving, unknown_other)
female_driving <- vehicles %>%
filter(sex_of_driver == "Female", vehicle_type == "Car") %>%
pull(accident_index)
unknown_other <- vehicles %>% #Filter out accident IDs where there's someone of unknown sex driving a car.
filter(accident_index %in% female_driving) %>%
filter(vehicle_type == "Car", sex_of_driver == "Not known") %>%
pull(accident_index)
female_driving <- setdiff(female_driving, unknown_other)
male_crash <- crashes %>%
filter(accident_index %in% male_driving) %>%
select(accident_severity, number_of_casualties) %>%
mutate(sex = "Male")
female_crash <- crashes %>%
filter(accident_index %in% female_driving) %>%
select(accident_severity, number_of_casualties) %>%
mutate(sex = "Female")
##In crashes where there was a male driver and a female driver, we've double counted.
gendered_crashes <- bind_rows(male_crash, female_crash)
gendered_crashes %>%
group_by(driver, accident_severity) %>%
summarise(n=n()) %>%
ggplot(aes(x=accident_severity, y=n, fill=sex)) + geom_col()
male_crash <- crashes %>%
filter(accident_index %in% male_driving) %>%
select(accident_severity, number_of_casualties) %>%
mutate(sex = "Male")
female_crash <- crashes %>%
filter(accident_index %in% female_driving) %>%
select(accident_severity, number_of_casualties) %>%
mutate(sex = "Female")
##In crashes where there was a male driver and a female driver, we've double counted.
gendered_crashes <- bind_rows(male_crash, female_crash)
gendered_crashes %>%
group_by(sex, accident_severity) %>%
summarise(n=n()) %>%
ggplot(aes(x=accident_severity, y=n, fill=sex)) + geom_col()
male_crash <- crashes %>%
filter(accident_index %in% male_driving) %>%
select(accident_severity, number_of_casualties) %>%
mutate(sex = "Male")
female_crash <- crashes %>%
filter(accident_index %in% female_driving) %>%
select(accident_severity, number_of_casualties) %>%
mutate(sex = "Female")
##In crashes where there was a male driver and a female driver, we've double counted.
gendered_crashes <- bind_rows(male_crash, female_crash)
gendered_crashes %>%
group_by(sex, accident_severity) %>%
summarise(n=n()) %>%
ggplot(aes(x=accident_severity, y=n, colour=sex)) + geom_col()
male_crash <- crashes %>%
filter(accident_index %in% male_driving) %>%
select(accident_severity, number_of_casualties) %>%
mutate(sex = "Male")
female_crash <- crashes %>%
filter(accident_index %in% female_driving) %>%
select(accident_severity, number_of_casualties) %>%
mutate(sex = "Female")
##In crashes where there was a male driver and a female driver, we've double counted.
gendered_crashes <- bind_rows(male_crash, female_crash)
gendered_crashes %>%
group_by(sex, accident_severity) %>%
summarise(n=n()) %>%
ggplot(aes(x=accident_severity, y=n, fill=sex)) + geom_bar()
male_crash <- crashes %>%
filter(accident_index %in% male_driving) %>%
select(accident_severity, number_of_casualties) %>%
mutate(sex = "Male")
female_crash <- crashes %>%
filter(accident_index %in% female_driving) %>%
select(accident_severity, number_of_casualties) %>%
mutate(sex = "Female")
##In crashes where there was a male driver and a female driver, we've double counted.
gendered_crashes <- bind_rows(male_crash, female_crash)
gendered_crashes %>%
group_by(sex, accident_severity) %>%
summarise(n=n()) %>%
ggplot(aes(x=accident_severity, y=n, colour=sex)) + geom_point()
male_crash <- crashes %>%
filter(accident_index %in% male_driving) %>%
select(accident_severity, number_of_casualties) %>%
mutate(sex = "Male")
female_crash <- crashes %>%
filter(accident_index %in% female_driving) %>%
select(accident_severity, number_of_casualties) %>%
mutate(sex = "Female")
##In crashes where there was a male driver and a female driver, we've double counted.
gendered_crashes <- bind_rows(male_crash, female_crash)
gendered_crashes %>%
group_by(sex, accident_severity) %>%
summarise(n=n()) %>%
ggplot(aes(x=accident_severity, y=n, colour=sex)) + geom_point() + ggthemes::theme_few() + ggthemes::scale_colour_few()
gendered_crashes %>%
group_by(sex, number_of_casualties) %>%
summarise(n=n()) %>%
ggplot(aes(x=accident_severity, y=n, colour=sex)) + geom_point() + ggthemes::theme_few() + ggthemes::scale_colour_few()
gendered_crashes %>%
group_by(sex, number_of_casualties) %>%
summarise(n=n()) %>%
ggplot(aes(x=number_of_casualties, y=n, colour=sex)) + geom_point() + ggthemes::theme_few() + ggthemes::scale_colour_few()
View(female_crash)
View(vehicles)
wy_crashes
plot(wy_crashes)
plot(wy_crashes, pal = rainbow())
plot(wy_crashes, pal = rainbow(7))
plot(wy_crashes, pal = rainbow(6))
plot(wy_crashes, pal = rainbow(10))
plot(wy_crashes, pal = rainbow(100))
plot(wy_crashes, pal = rainbow(10))
plot(crashes)
plot(crashes %>% format_sf())
crash_gb <- crashes %>% format_sf()
plot(crash_gb)
crash_gb
crash_gb %>% select(accident_index)
crash_gb %>% select(accident_index) %>% plot()
crash_gb %>% select(accident_index)
plot(crash_gb %>% select(accident_index))
gb <- crash_gb %>% select(accident_index)
gb
plot(gb)
plot(gb)
crash_gb %>%
select(longitude) %>%
plot()
blogdown::stop_server()
95/98 * 100
97*0.02
